<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù‡ÙˆØ´ ØªØ¬Ø§Ø±ÛŒ: Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ùˆ Ø®Ù„Ù‚ Ø¯Ø±Ø¢Ù…Ø¯ | Û±Û´Û°Û´-Û±Û´Û°Û¹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Vazirmatn', sans-serif; background-color: #f8fafc; color: #0f172a; overflow-x: hidden; }
        
        /* Corporate Cards */
        .corp-card { background: #ffffff; border-radius: 1.25rem; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.03), 0 2px 4px -1px rgba(0,0,0,0.02); transition: all 0.3s ease; border: 1px solid #e2e8f0; position: relative; }
        
        /* Tourism Base Cards - ENHANCED (Interactive Numbers) */
        .tourism-card { padding: 1.5rem; display: flex; flex-direction: column; justify-content: space-between; z-index: 1; overflow: hidden; }
        .tourism-icon-bg { position: absolute; left: -5%; top: -10%; font-size: 8rem; opacity: 0.05; transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1); z-index: -1; pointer-events: none; }
        .corp-card:hover .tourism-icon-bg { opacity: 0.15; transform: scale(1.1) rotate(-5deg); }
        .corp-card:hover { transform: translateY(-4px); box-shadow: 0 15px 30px -5px rgba(14, 165, 233, 0.15); border-color: #bae6fd; }

        /* Real Estate Portfolio Cards */
        .re-card { padding: 1.25rem; z-index: 1; border-top: 4px solid transparent; overflow: visible !important; }
        .re-card:hover { transform: translateY(-4px); box-shadow: 0 15px 30px -5px rgba(168, 85, 247, 0.15); border-top-color: #d946ef; z-index: 50; }
        .sparkline-box { height: 60px; width: 100%; margin-top: 10px; }
        
        /* Mini Donut & Custom Tooltip */
        .mini-donut { width: 38px; height: 38px; border-radius: 50%; display: flex; align-items: center; justify-content: center; position: relative; box-shadow: 0 2px 4px rgba(0,0,0,0.1); cursor: pointer; }
        .mini-donut-inner { width: 26px; height: 26px; background-color: #ffffff; border-radius: 50%; position: relative; z-index: 10; display: flex; align-items: center; justify-content: center; font-size: 0.55rem; font-weight: 800; color: #334155; }
        .donut-tooltip { visibility: hidden; position: absolute; top: 115%; right: -10px; width: max-content; min-width: 150px; background: #1e293b; color: white; border-radius: 8px; padding: 10px; font-size: 0.75rem; opacity: 0; transition: 0.3s; z-index: 99999; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.5); text-align: right; }
        .donut-tooltip::after { content: ""; position: absolute; bottom: 100%; right: 20px; border-width: 6px; border-style: solid; border-color: transparent transparent #1e293b transparent; }
        .group-donut:hover .donut-tooltip { visibility: visible; opacity: 1; top: 125%; }

        /* Custom Elegant Sliders */
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]:focus { outline: none; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 6px; cursor: pointer; border-radius: 3px; background: #cbd5e1; }
        input[type=range]::-webkit-slider-thumb { height: 18px; width: 18px; border-radius: 50%; background: #ffffff; cursor: pointer; -webkit-appearance: none; margin-top: -6px; border: 3px solid currentColor; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: 0.2s transform; position: relative; z-index: 10; }
        input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.2); }
        .slider-cyan::-webkit-slider-thumb { color: #0ea5e9; }
        .slider-purple::-webkit-slider-thumb { color: #d946ef; }
        .slider-emerald::-webkit-slider-thumb { color: #10b981; }

        /* General Tooltips */
        .has-tooltip { position: relative; cursor: help; }
        .custom-tooltip { visibility: hidden; position: absolute; top: 130%; right: 50%; transform: translateX(50%); width: 220px; background: #0f172a; color: white; border-radius: 8px; padding: 10px; font-size: 0.75rem; text-align: justify; opacity: 0; transition: 0.3s; pointer-events: none; z-index: 9999; line-height: 1.6; }
        .has-tooltip:hover .custom-tooltip { visibility: visible; opacity: 1; top: 140%; }

        /* Sticky Sidebar */
        .sidebar-panel { transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .overlay { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(2px); transition: opacity 0.3s; z-index: 40; }

        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 4px; height: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }

        /* KPI Console Elements & Animations */
        .kpi-stat-box { border-right: 1px solid #e2e8f0; padding: 1rem; transition: background-color 0.3s ease; border-radius: 1rem; cursor: default; }
        .kpi-stat-box:first-child { border-right: none; }
        .kpi-stat-box:hover { background-color: #f8fafc; }
        
        @keyframes pulse-soft { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.15); } }
        @keyframes float-up { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-4px); } }
        @keyframes bounce-soft { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-6px); } }
        @keyframes rock { 0%, 100% { transform: rotate(0deg); } 25% { transform: rotate(-10deg); } 75% { transform: rotate(10deg); } }
        
        .group-kpi:hover .anim-pulse { animation: pulse-soft 1s infinite; }
        .group-kpi:hover .anim-float { animation: float-up 1s infinite ease-in-out; }
        .group-kpi:hover .anim-bounce { animation: bounce-soft 1s infinite ease-in-out; }
        .group-kpi:hover .anim-rock { animation: rock 1s infinite ease-in-out; }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <header class="w-full bg-white shadow-sm border-b-4 border-b-indigo-600 p-4 md:py-5 md:px-8 flex flex-col md:flex-row justify-between items-center z-50 relative">
        <div class="w-1/3 flex justify-start mb-4 md:mb-0"><img src="https://uploadkon.ir/uploads/c1c428_25logo-IMPcoPNG.png" alt="Ø¨Ù†ÛŒØ§Ø¯ Ù…Ø³ØªØ¶Ø¹ÙØ§Ù†" class="h-12 md:h-14 object-contain"></div>
        <div class="w-full md:w-1/3 text-center mb-4 md:mb-0">
            <img src="https://uploadkon.ir/uploads/df5427_25NA-LOGO-copy.png" alt="Ù†Ù…Ú© Ø¢Ø¨Ø±ÙˆØ¯" class="h-14 md:h-16 object-contain mx-auto mb-2 drop-shadow-md">
            <h1 class="text-xl md:text-2xl font-black text-slate-800 tracking-tight">Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø¬Ø§Ù…Ø¹ Ø¨Ø±Ø¢ÙˆØ±Ø¯ Ùˆ Ø®Ù„Ù‚ Ø¯Ø±Ø¢Ù…Ø¯</h1>
            <p class="text-[11px] md:text-sm text-slate-500 font-bold mt-1 tracking-wide">Ù…Ø¯ÛŒØ±ÛŒØª Ù¾ÙˆØ±ØªÙÙˆÛŒ Ø¯Ø§Ø±Ø§ÛŒÛŒâ€ŒÙ‡Ø§ Ùˆ Ø¬Ø±ÛŒØ§Ù† Ù†Ù‚Ø¯ÛŒ Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒÚ©</p>
        </div>
        <div class="w-1/3 flex justify-end"><img src="https://uploadkon.ir/uploads/611127_25OMS-LOGO-copy.png" alt="Ø¹Ù…Ø±Ø§Ù† Ùˆ Ù…Ø³Ú©Ù†" class="h-10 md:h-12 object-contain"></div>
    </header>

    <div id="settingsOverlay" class="fixed inset-0 overlay hidden xl:hidden" onclick="toggleSettings()"></div>
    
    <div class="w-full max-w-[1650px] mx-auto flex flex-col xl:flex-row gap-6 items-start relative px-4 md:px-6 py-6 flex-1">
        
        <aside id="settingsSidebar" class="sidebar-panel fixed inset-y-0 right-0 w-80 bg-white z-50 transform translate-x-full overflow-y-auto custom-scrollbar shadow-2xl xl:shadow-none xl:translate-x-0 xl:static xl:w-[23%] xl:bg-transparent xl:block xl:sticky xl:top-6 xl:h-[calc(100vh-2rem)]">
            <div class="p-5 xl:p-0">
                <div class="flex justify-between items-center xl:hidden mb-6 border-b pb-3">
                    <h2 class="font-black text-lg text-slate-800">Ù¾Ù†Ù„ ÙØ±Ù…Ø§Ù† Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒÚ©</h2>
                    <button onclick="toggleSettings()" class="text-slate-400 hover:text-rose-500"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
                </div>
                
                <div class="space-y-5 pb-10">
                    
                    <div class="corp-card p-5">
                        <div class="flex justify-between items-center mb-5 border-b border-slate-100 pb-3">
                            <h3 class="font-black text-slate-800 flex items-center text-sm">
                                <span class="w-1.5 h-4 bg-indigo-500 rounded-sm ml-2"></span>Ø§Ù‡Ø±Ù…â€ŒÙ‡Ø§ÛŒ Ú©Ù„Ø§Ù† Ù…Ø§Ù„ÛŒ
                            </h3>
                            <button onclick="resetAll()" class="text-[10px] font-bold text-slate-500 hover:text-indigo-600 bg-slate-50 px-2 py-1 rounded border border-slate-200 transition-colors">Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ</button>
                        </div>
                        
                        <div class="mb-5">
                            <div class="flex justify-between text-xs mb-1">
                                <span class="font-bold text-slate-600">Ø±Ø´Ø¯ ØªÙˆØ±Ù…ÛŒ Ú¯Ø±Ø¯Ø´Ú¯Ø±ÛŒ</span>
                                <span id="val-tourism" class="font-black text-cyan-600 bg-cyan-50 px-1.5 rounded">35%</span>
                            </div>
                            <input type="range" id="sl-tourism" class="slider-cyan" min="20" max="70" value="35">
                            <p class="text-[9px] text-slate-400 mt-1">Ù†Ø±Ø® Ø±Ø´Ø¯ ØªØ±Ú©ÛŒØ¨ÛŒ Ø³Ø§Ù„Ø§Ù†Ù‡ (Ø¨Ø®Ø´Ù†Ø§Ù…Ù‡)</p>
                        </div>

                        <div class="mb-5">
                            <div class="flex justify-between text-xs mb-1">
                                <span class="font-bold text-slate-600">ØªØ¹Ø¯ÛŒÙ„ Ù‚ÛŒÙ…Øª Ø§Ù…Ù„Ø§Ú©</span>
                                <span id="val-housing" class="font-black text-fuchsia-600 bg-fuchsia-50 px-1.5 rounded">0% (Ù¾Ø§ÛŒÙ‡)</span>
                            </div>
                            <input type="range" id="sl-housing" class="slider-purple" min="-30" max="100" value="0">
                            <p class="text-[9px] text-slate-400 mt-1">ØªØ£Ø«ÛŒØ± Ù†ÙˆØ³Ø§Ù†Ø§Øª Ø¨Ø§Ø²Ø§Ø± Ø¨Ø± Ø¨Ø±Ø¢ÙˆØ±Ø¯ Ù¾Ø§ÛŒÙ‡</p>
                        </div>

                        <div>
                            <div class="flex justify-between text-xs mb-1">
                                <span class="font-bold text-slate-600">Ù†Ø±Ø® ØªØ®ØµÛŒØµ ØªÙˆØ³Ø¹Ù‡ Ø²ÛŒØ±Ø³Ø§Ø®Øª</span>
                                <span id="val-infra" class="font-black text-emerald-600 bg-emerald-50 px-1.5 rounded">30%</span>
                            </div>
                            <input type="range" id="sl-infra" class="slider-emerald" min="10" max="50" value="30">
                            <p class="text-[9px] text-slate-400 mt-1 leading-tight text-justify">ØªØ¹ÛŒÛŒÙ†â€ŒÚ©Ù†Ù†Ø¯Ù‡ Ø³Ù‡Ù… Ù…Ø¬Ø§Ø² Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ø±Ø§Ù†ÛŒ Ø¯Ø± Ø¨Ø±Ø§Ø¨Ø± Ø³ÙˆØ¯ Ø®Ø§Ù„Øµ Ø³Ù‡Ø§Ù…Ø¯Ø§Ø± (Ø®Ø²Ø§Ù†Ù‡)</p>
                        </div>
                    </div>

                    <div class="bg-slate-800 text-white rounded-[1.25rem] p-5 shadow-lg relative border border-slate-700 z-50">
                        <div class="absolute inset-0 overflow-hidden pointer-events-none rounded-[1.25rem] z-0">
                            <div class="absolute -right-12 -top-12 w-32 h-32 bg-purple-500 rounded-full blur-[50px] opacity-20"></div>
                        </div>
                        
                        <div class="relative z-10">
                            <h3 class="font-black text-sm flex items-center mb-2">
                                <span class="w-1.5 h-4 bg-purple-400 rounded-sm ml-2"></span>ØªÙˆØ²ÛŒØ¹ Ø²Ù…Ø§Ù†ÛŒ Ø¯Ø±Ø¢Ù…Ø¯Ù‡Ø§ÛŒ Ù…Ù„Ú©ÛŒ
                            </h3>
                            <div class="bg-slate-900/60 border border-slate-600/50 p-2.5 rounded-lg mb-4 text-[9px] leading-relaxed text-slate-300 text-justify">
                                <span class="text-purple-300 font-bold">Ø±Ø§Ù‡Ø¨Ø±Ø¯ Ù†Ù‚Ø¯Ø´ÙˆÙ†Ø¯Ú¯ÛŒ:</span> Ø¨Ø§ Ø¹Ù†Ø§ÛŒØª Ø¨Ù‡ Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ø§Ø®Ø° Ù…Ø¬ÙˆØ²Ø§ØªØŒ Ø·ÛŒ Ù…Ø±Ø§Ø­Ù„ Ø³Ø§Ø®Øª Ùˆ ÙØ§Ø²Ø¨Ù†Ø¯ÛŒ Ù¾ÛŒØ´â€ŒÙØ±ÙˆØ´ØŒ Ø³Ù‚Ù ØªØ­Ù‚Ù‚ Ø¯Ø±Ø¢Ù…Ø¯Ù‡Ø§ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø´Ø§Ø±Ú©ØªÛŒ ØªØ§ Ù¾Ø§ÛŒØ§Ù† Ø§ÙÙ‚ Û±Û´Û°Û¹ Ù…Ø¹Ø§Ø¯Ù„ <b class="text-white">Û¶Û°Ùª</b> Ø¨Ø±Ø¢ÙˆØ±Ø¯ Ú¯Ø±Ø¯ÛŒØ¯Ù‡ Ø§Ø³Øª. ØªØ­Ù‚Ù‚ Û´Û°Ùª Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡ Ø¨Ù‡ Ø³Ù†ÙˆØ§Øª Ø¢ØªÛŒ Ù…ÙˆÚ©ÙˆÙ„ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.
                            </div>
                            
                            <div class="mb-5 bg-slate-900/50 p-3 rounded-lg border border-slate-600">
                                <div class="flex justify-between text-[10px] mb-2 font-bold text-slate-300">
                                    <span>Ù…Ø¬Ù…ÙˆØ¹ Ø§ÙÙ‚ Ûµ Ø³Ø§Ù„Ù‡: <b id="val-total-alloc" class="text-purple-400 text-xs">60%</b></span>
                                    <span>Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ Ø¢ØªÛŒ: <b id="val-free-alloc" class="text-slate-400 text-xs">40%</b></span>
                                </div>
                                <div class="w-full bg-slate-700 rounded-full h-1.5 flex overflow-hidden">
                                    <div id="bar-alloc" class="bg-purple-400 h-full transition-all duration-300" style="width: 60%"></div>
                                </div>
                            </div>

                            <div class="grid grid-cols-2 gap-x-4 gap-y-4" id="housing-sliders-container"></div>
                        </div>
                    </div>
                </div>
            </aside>

            <main class="w-full xl:w-[77%] flex flex-col gap-6 z-10">
                
                <div class="bg-white border-r-4 border-r-indigo-500 rounded-xl p-4 shadow-sm text-sm text-slate-600 leading-relaxed text-justify">
                    <strong class="text-slate-800">ØªØ­Ù„ÛŒÙ„â€ŒÚ¯Ø± Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒÚ©:</strong> 
                    Ø§ÛŒÙ† Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø¬Ø±ÛŒØ§Ù†â€ŒÙ‡Ø§ÛŒ Ù†Ù‚Ø¯ÛŒÙ ÙˆØ±ÙˆØ¯ÛŒ Ø´Ø±Ú©Øª Ø±Ø§ Ø¯Ø± Ø¯Ùˆ Ø­ÙˆØ²Ù‡ <b>Ø¹Ù…Ù„ÛŒØ§ØªÛŒ (Ú¯Ø±Ø¯Ø´Ú¯Ø±ÛŒ)</b> Ùˆ <b>Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ (Ù…Ø³Ú©ÙˆÙ†ÛŒ/Ù…Ø´Ø§Ø±Ú©ØªÛŒ)</b> Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯. Ø¨Ø§ ØªØºÛŒÛŒØ± Ø§Ù‡Ø±Ù…â€ŒÙ‡Ø§ÛŒ Ø³Ù…Øª Ø±Ø§Ø³ØªØŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù ØªÙˆØ±Ù…ÛŒ Ùˆ Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ ÙØ±ÙˆØ´ Ø±Ø§ Ø¢Ø²Ù…Ø§ÛŒØ´ Ú©Ø±Ø¯Ù‡ Ùˆ Ù…ÛŒØ²Ø§Ù† <b>Ø®Ù„Ù‚ Ø«Ø±ÙˆØª Ø®Ø§Ù„Øµ</b> Ø±Ø§ ØªØ§ Ø³Ø§Ù„ Û±Û´Û°Û¹ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ù†ÛŒØ¯.
                </div>

                <div>
                    <h2 class="text-lg font-black mb-4 text-slate-800 flex items-center">
                        <span class="w-2 h-6 bg-gradient-to-b from-cyan-400 to-blue-500 rounded-sm ml-2"></span>
                        Ù…ÙˆØªÙˆØ± Ø¯Ø±Ø¢Ù…Ø¯Ù‡Ø§ÛŒ Ú¯Ø±Ø¯Ø´Ú¯Ø±ÛŒ Ùˆ Ø¹Ù…Ù„ÛŒØ§ØªÛŒ
                    </h2>
                    
                    <p class="text-xs font-bold text-slate-500 mb-3">Ø¹Ù…Ù„Ú©Ø±Ø¯ Ù¾Ø§ÛŒÙ‡ Ø³Ø§Ù„ Û±Û´Û°Û´ (Ù…Ø¨Ø§Ù„Øº Ø¨Ù‡ Ù…ÛŒÙ„ÛŒØ§Ø±Ø¯ ØªÙˆÙ…Ø§Ù†)</p>
                    <div class="grid grid-cols-2 lg:grid-cols-5 gap-3 md:gap-4 mb-6">
                        <div class="corp-card tourism-card h-32 group"><span class="tourism-icon-bg text-cyan-500">ğŸš </span><p class="text-sm font-black text-slate-600">ØªÙ„Ù‡â€ŒÚ©Ø§Ø¨ÛŒÙ† (Ø®Ø· Û± Ùˆ Û²)</p><p class="text-3xl md:text-4xl font-black text-slate-900 mt-auto transition-colors duration-300 group-hover:text-cyan-600">Û´ÛµÛ¸.Û¸</p></div>
                        <div class="corp-card tourism-card h-32 group"><span class="tourism-icon-bg text-cyan-500">ğŸ¢</span><p class="text-sm font-black text-slate-600">Ø³ÙˆØ±ØªÙ…Ù‡</p><p class="text-3xl md:text-4xl font-black text-slate-900 mt-auto transition-colors duration-300 group-hover:text-cyan-600">Û¸Û·.Û²</p></div>
                        <div class="corp-card tourism-card h-32 group"><span class="tourism-icon-bg text-cyan-500">ğŸŸï¸</span><p class="text-sm font-black text-slate-600">Ø®Ø¯Ù…Ø§Øª ØªÙˆØ±ÛŒØ³ØªÛŒ</p><p class="text-3xl md:text-4xl font-black text-slate-900 mt-auto transition-colors duration-300 group-hover:text-cyan-600">Û´Û¹Ûµ.Û³</p></div>
                        <div class="corp-card tourism-card h-32 group"><span class="tourism-icon-bg text-cyan-500">ğŸ˜ï¸</span><p class="text-sm font-black text-slate-600">Ø®Ø¯Ù…Ø§Øª Ø´Ù‡Ø±Ú© <span class="text-[9px] font-normal">(Ø´Ø§Ø±Ú˜/Ù¾Ø±ÙˆØ§Ù†Ù‡)</span></p><p class="text-3xl md:text-4xl font-black text-slate-900 mt-auto transition-colors duration-300 group-hover:text-cyan-600">Û²Û°Û¹.Û²</p></div>
                        <div class="corp-card tourism-card h-32 group"><span class="tourism-icon-bg text-cyan-500">ğŸ”‘</span><p class="text-sm font-black text-slate-600">Ø§Ø¬Ø§Ø±Ù‡â€ŒØ§ÛŒ Ùˆ ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§</p><p class="text-3xl md:text-4xl font-black text-slate-900 mt-auto transition-colors duration-300 group-hover:text-cyan-600">Û±Û·Û³.Û²</p></div>
                    </div>

                    <div class="corp-card p-5">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-sm font-black text-slate-700">Ø±ÙˆÙ†Ø¯ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø¯Ø±Ø¢Ù…Ø¯Ù‡Ø§ÛŒ Ú¯Ø±Ø¯Ø´Ú¯Ø±ÛŒ (Û±Û´Û°Ûµ - Û±Û´Û°Û¹)</h3>
                            <div class="bg-cyan-50 text-cyan-700 text-xs font-bold px-3 py-1 rounded-md" id="lbl-total-tourism">Ù…Ø¬Ù…ÙˆØ¹: - Ù‡Ù…Øª</div>
                        </div>
                        <div class="h-60 w-full"><canvas id="tourismChart"></canvas></div>
                    </div>
                </div>

                <div class="pt-4">
                    <h2 class="text-lg font-black mb-4 text-slate-800 flex items-center">
                        <span class="w-2 h-6 bg-gradient-to-b from-purple-500 to-pink-500 rounded-sm ml-2"></span>
                        Ù¾ÙˆØ±ØªÙÙˆÛŒ Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø³Ú©ÙˆÙ†ÛŒ Ùˆ Ù…Ø´Ø§Ø±Ú©ØªÛŒ
                    </h2>
                    
                    <p class="text-xs font-bold text-slate-500 mb-3">Ø³Ø¨Ø¯ Ø¯Ø§Ø±Ø§ÛŒÛŒâ€ŒÙ‡Ø§ (Ù†Ù…Ø§ÛŒØ´ ÙˆØ²Ù† Ù¾Ø±ÙˆÚ˜Ù‡ Ùˆ Ù†Ù…ÙˆØ¯Ø§Ø± Ù…Ø³Ø§Ø­ØªÛŒ Ù†Ù‚Ø¯Ø´ÙˆÙ†Ø¯Ú¯ÛŒ)</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6" id="portfolio-container"></div>

                    <div class="corp-card p-5">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-sm font-black text-slate-700">Ù‚Ù„Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø¢Ù…Ø¯ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø´Ø§Ø±Ú©ØªÛŒ (Stacked Area)</h3>
                            <div class="bg-fuchsia-50 text-fuchsia-700 text-xs font-bold px-3 py-1 rounded-md" id="lbl-total-housing">Ù…Ø¬Ù…ÙˆØ¹: - Ù‡Ù…Øª</div>
                        </div>
                        <div class="h-80 w-full"><canvas id="housingChart"></canvas></div>
                    </div>
                </div>

                <div class="pt-4 mb-10">
                    <h2 class="text-lg font-black mb-4 text-slate-800 flex items-center">
                        <span class="w-2 h-6 bg-slate-800 rounded-sm ml-2"></span>
                        Ú©Ù†Ø³ÙˆÙ„ Ø¬Ø§Ù…Ø¹ Ø´Ø§Ø®Øµâ€ŒÙ‡Ø§ÛŒ Ú©Ù„ÛŒØ¯ÛŒ (Ø³Ù†ØªØ² Ù…Ø§Ù„ÛŒ)
                    </h2>
                    
                    <div class="corp-card p-6 bg-white border-t-4 border-t-slate-800">
                        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-center">
                            
                            <div class="lg:col-span-3 flex flex-col items-center justify-center relative border-b lg:border-b-0 lg:border-l border-slate-100 pb-6 lg:pb-0">
                                <div class="h-44 w-full relative">
                                    <canvas id="mixChart"></canvas>
                                    <div class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none mt-2">
                                        <span class="text-[10px] font-bold text-slate-400">Ø¸Ø±ÙÛŒØª Ú©Ù„</span>
                                        <span class="text-xl font-black text-slate-800" id="donut-total">0</span>
                                    </div>
                                </div>
                                <div class="w-full mt-4 bg-slate-50 rounded-full h-2.5 flex overflow-hidden shadow-inner">
                                    <div id="bar-mix-tourism" class="bg-cyan-500 h-full transition-all duration-500" style="width: 50%"></div>
                                    <div id="bar-mix-housing" class="bg-purple-500 h-full transition-all duration-500" style="width: 50%"></div>
                                </div>
                                <div class="flex justify-between w-full text-[10px] font-bold mt-1 text-slate-500 px-1">
                                    <span id="lbl-mix-tourism" class="text-cyan-600">Ú¯Ø±Ø¯Ø´Ú¯Ø±ÛŒ</span>
                                    <span id="lbl-mix-housing" class="text-purple-600">Ù…Ø³Ú©ÙˆÙ†ÛŒ</span>
                                </div>
                            </div>

                            <div class="lg:col-span-9 grid grid-cols-2 md:grid-cols-4 gap-4">
                                <div class="kpi-stat-box group-kpi group">
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="text-2xl anim-pulse text-slate-600">ğŸ¦</span>
                                        <p class="text-[10px] font-bold text-slate-500 uppercase">Ø¸Ø±ÙÛŒØª Ú©Ù„ Ûµ Ø³Ø§Ù„Ù‡</p>
                                    </div>
                                    <p class="text-2xl font-black text-slate-800 transition-colors duration-300 group-hover:text-amber-500" id="kpi-total">0 <span class="text-xs text-slate-500 font-bold group-hover:text-slate-500">Ù‡Ù…Øª</span></p>
                                </div>
                                
                                <div class="kpi-stat-box group-kpi group">
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="text-2xl anim-float text-slate-600">ğŸ“ˆ</span>
                                        <p class="text-[10px] font-bold text-slate-500 uppercase">Ù…ØªÙˆØ³Ø· Ø¯Ø±Ø¢Ù…Ø¯ Ø³Ø§Ù„Ø§Ù†Ù‡</p>
                                    </div>
                                    <p class="text-2xl font-black text-slate-700 transition-colors duration-300 group-hover:text-amber-500" id="kpi-avg">0 <span class="text-xs text-slate-500 font-bold group-hover:text-slate-500">Ù‡Ù…Øª</span></p>
                                </div>
                                
                                <div class="kpi-stat-box group-kpi group">
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="text-2xl anim-bounce text-blue-500">ğŸ’¼</span>
                                        <p class="text-[10px] font-bold text-slate-500 uppercase">Ø³ÙˆØ¯ Ø®Ø§Ù„Øµ Ø³Ù‡Ø§Ù…Ø¯Ø§Ø±</p>
                                    </div>
                                    <p class="text-2xl font-black text-blue-600 transition-colors duration-300 group-hover:text-blue-500" id="kpi-shareholder">0 <span class="text-xs text-blue-400 font-bold">Ù‡Ù…Øª</span></p>
                                    <p class="text-[9px] font-bold text-blue-500 bg-blue-50 inline-block px-1.5 rounded mt-1" id="lbl-shareholder-perc">70% ØªØ®ØµÛŒØµ</p>
                                </div>
                                
                                <div class="kpi-stat-box group-kpi group">
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="text-2xl anim-rock text-emerald-500">ğŸ—ï¸</span>
                                        <p class="text-[10px] font-bold text-slate-500 uppercase">Ø¨ÙˆØ¯Ø¬Ù‡ Ù…Ø¬Ø§Ø² ØªÙˆØ³Ø¹Ù‡</p>
                                    </div>
                                    <p class="text-2xl font-black text-emerald-600 transition-colors duration-300 group-hover:text-emerald-500" id="kpi-infra">0 <span class="text-xs text-emerald-400 font-bold">Ù‡Ù…Øª</span></p>
                                    <p class="text-[9px] font-bold text-emerald-600 bg-emerald-50 inline-block px-1.5 rounded mt-1" id="lbl-infra-perc">30% ØªØ®ØµÛŒØµ</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <footer class="w-full bg-slate-800 text-slate-400 text-center py-5 text-xs font-medium relative z-[100] border-t border-slate-700">
        ØªÙ‡ÛŒÙ‡ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· 
        <span class="relative group cursor-pointer text-white font-bold inline-block mx-1">
            Ù…Ù‡Ù†Ø¯Ø³ÛŒÙ† Ù…Ø´Ø§ÙˆØ± Ø§ÛŒØ¯Ù‡ Ù¾Ø±Ø¯Ø§Ø² Ù…Ø­ÛŒØ·
            <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-3 hidden group-hover:block bg-slate-900 text-white text-xs p-3 rounded-xl shadow-[0_10px_25px_-5px_rgba(0,0,0,0.5)] w-56 text-center border border-slate-600 transition-all z-[9999]">
                <p class="font-black text-sky-400 mb-1">ØªØ­Ù„ÛŒÙ„ Ùˆ Ø·Ø±Ø§Ø­ÛŒ:</p>
                <p class="font-bold text-base mb-1 text-white">Ø­Ù…ÛŒØ¯Ø±Ø¶Ø§ ØªØ±Ø§Ø¨ÛŒ</p>
                <p class="text-slate-400 font-mono text-[10px]">hr.torabii@gmail.com</p>
                <div class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-slate-600"></div>
            </div>
        </span>
        - Ø§Ø³ÙÙ†Ø¯ Ù…Ø§Ù‡ Û±Û´Û°Û´
    </footer>

    <button onclick="toggleSettings()" class="xl:hidden fixed bottom-6 left-6 z-40 bg-indigo-600 text-white p-4 rounded-full shadow-[0_10px_20px_rgba(79,70,229,0.4)] hover:bg-indigo-700 transition transform hover:scale-105 flex items-center gap-2">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path></svg>
        <span class="font-bold hidden sm:inline">Ø§Ù‡Ø±Ù…â€ŒÙ‡Ø§ÛŒ Ù…Ø§Ù„ÛŒ</span>
    </button>

    <script>
        function toggleSettings() {
            const sidebar = document.getElementById('settingsSidebar');
            const overlay = document.getElementById('settingsOverlay');
            if(sidebar.classList.contains('translate-x-full')) {
                sidebar.classList.remove('translate-x-full');
                overlay.classList.remove('hidden');
            } else {
                sidebar.classList.add('translate-x-full');
                overlay.classList.add('hidden');
            }
        }

        const BASE_TOURISM_1404 = 1423.7; 

        const projectsData = [
            { id: 'p1', name: "Ø²ÙˆØ¯Ø¨Ø§Ø²Ø¯Ù‡ (Ù…Ø´Ù‡Ø¯ Ùˆ ØªÙˆØ³Ú©Ø§)", icon: "ğŸ¢", color: "#ec4899", baseTotal: 4527 },
            { id: 'p2', name: "Ø¨Ø§Øº Ú©ÛŒÙˆÛŒ", icon: "ğŸŒ³", color: "#a855f7", baseTotal: 3780 },
            { id: 'p3', name: "Ø¨Ø±Ø¬â€ŒÙ‡Ø§ÛŒ Ù„ÙˆØªÙˆØ³", icon: "ğŸ™ï¸", color: "#6366f1", baseTotal: 11107 },
            { id: 'p4', name: "ØªÙˆØ³Ø¹Ù‡ Ø¢Ú©Ø§Ù… ÙÙˆÙ„Ø§Ø¯", icon: "ğŸ—ï¸", color: "#f59e0b", baseTotal: 5949 },
            { id: 'p5', name: "Ø¢ØªÛŒÙ‡ Ø³Ø§Ø²Ø§Ù† Ù…Ù‡Ø±", icon: "ğŸ—ï¸", color: "#14b8a6", baseTotal: 5663 },
            { id: 'p6', name: "Ù…Ø­Ù„Ù‡ Û· Ùˆ Û¸", icon: "ğŸ˜ï¸", color: "#8b5cf6", baseTotal: 1958 },
            { id: 'p7', name: "Ù‚Ø·Ø¹Ø§Øª ÙØ§Ù‚Ø¯ Ø´Ø±ÛŒÚ©", icon: "ğŸ—ºï¸", color: "#64748b", baseTotal: 32743 },
            { id: 'p8', name: "Ø³Ø§ÛŒØ± Ø´Ø±Ú©Ø§", icon: "ğŸ¤", color: "#f43f5e", baseTotal: 21520 }
        ];

        let state = {
            tourismGrowth: 35,
            rePriceMod: 0,
            infraShare: 30,
            allocations: [0, 10, 20, 20, 10] 
        };

        let tourismChart, housingChart, mixChart;
        let sparklineCharts = {};

        function updateDashboard() {
            let tourismSeries = [];
            let totalTourism = 0;
            for(let i=1; i<=5; i++) {
                let val = BASE_TOURISM_1404 * Math.pow(1 + (state.tourismGrowth / 100), i);
                tourismSeries.push(val);
                totalTourism += val;
            }

            let reModFactor = 1 + (state.rePriceMod / 100);
            let totalMultiplier = state.allocations.reduce((a,b)=>a+b, 0) / 100; 
            
            let grandTotalRE_100 = projectsData.reduce((sum, p) => sum + p.baseTotal, 0) * reModFactor;
            let grandTotalRE_Realized = grandTotalRE_100 * totalMultiplier; 
            
            const portfolioContainer = document.getElementById('portfolio-container');
            portfolioContainer.innerHTML = '';
            
            projectsData.forEach(proj => {
                let projTotal100 = proj.baseTotal * reModFactor;
                let projSeries = state.allocations.map(pct => projTotal100 * (pct / 100));
                let projRealized = projSeries.reduce((a,b)=>a+b, 0);
                
                let weightPerc = grandTotalRE_Realized > 0 ? ((projRealized / grandTotalRE_Realized) * 100).toFixed(1) : 0;

                let peakVal = Math.max(...projSeries);
                let peakIdx = projSeries.indexOf(peakVal);
                let peakYear = 1405 + peakIdx;

                let conicStyle = `conic-gradient(${proj.color} ${weightPerc}%, #f1f5f9 0)`;

                // V4 FIX: Full un-truncated names & Working Tooltips
                let cardHtml = `
                    <div class="corp-card re-card group" style="border-top-color: ${projRealized>0 ? proj.color : '#e2e8f0'}">
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex items-center gap-2 flex-1">
                                <span class="text-2xl">${proj.icon}</span>
                                <h4 class="font-bold text-slate-700 text-[13px] leading-tight" title="${proj.name}">${proj.name}</h4>
                            </div>
                            
                            <div class="group-donut relative ml-1 shrink-0">
                                <div class="mini-donut" style="background: ${conicStyle}">
                                    <div class="mini-donut-inner">${Math.round(weightPerc)}%</div>
                                </div>
                                <div class="donut-tooltip">
                                    <p class="font-bold text-sky-300 mb-1 border-b border-slate-600 pb-1 text-right">${proj.name}</p>
                                    <p class="text-right">ÙˆØ²Ù† Ø¯Ø± Ù¾ÙˆØ±ØªÙÙˆÛŒ: <b class="text-white">${weightPerc}Ùª</b></p>
                                    <p class="mt-1 text-right">Ø³Ù‡Ù… Ø±ÛŒØ§Ù„ÛŒ: <b class="text-white">${(projRealized/1000).toFixed(2)} Ù‡Ù…Øª</b></p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-1">
                            <p class="text-[10px] text-slate-400 font-bold mb-1">Ø§Ø±Ø²Ø´ ØªØ­Ù‚Ù‚â€ŒÛŒØ§ÙØªÙ‡ (Ø§ÙÙ‚ Ûµ Ø³Ø§Ù„Ù‡):</p>
                            <p class="text-2xl font-black text-slate-800 transition-colors" style="color: ${proj.color}">${(projRealized/1000).toFixed(2)} <span class="text-xs font-normal text-slate-400">Ù‡Ù…Øª</span></p>
                        </div>
                        
                        <div class="relative mt-2">
                            ${projRealized > 0 && peakVal > 0 ? `<p class="absolute left-0 -top-2 text-[8px] font-bold px-1.5 py-0.5 rounded shadow-sm text-white z-10" style="background-color: ${proj.color}">Ø§ÙˆØ¬: ${peakYear}</p>` : ''}
                            <div class="sparkline-box"><canvas id="spark-${proj.id}"></canvas></div>
                        </div>
                    </div>
                `;
                portfolioContainer.innerHTML += cardHtml;
            });

            projectsData.forEach(proj => {
                let projTotal100 = proj.baseTotal * reModFactor;
                let projSeries = state.allocations.map(pct => projTotal100 * (pct / 100));
                drawSparkline(`spark-${proj.id}`, projSeries, proj.color);
            });

            let totalCapacity = totalTourism + grandTotalRE_Realized;
            let infraBudget = totalCapacity * (state.infraShare / 100);
            let shareholder = totalCapacity - infraBudget;

            document.getElementById('lbl-total-tourism').innerText = `Ù…Ø¬Ù…ÙˆØ¹ Ûµ Ø³Ø§Ù„Ù‡: ${(totalTourism/1000).toFixed(1)} Ù‡Ù…Øª`;
            document.getElementById('lbl-total-housing').innerText = `Ù…Ø¬Ù…ÙˆØ¹ Ûµ Ø³Ø§Ù„Ù‡: ${(grandTotalRE_Realized/1000).toFixed(1)} Ù‡Ù…Øª`;
            
            document.getElementById('kpi-total').innerHTML = `${(totalCapacity/1000).toFixed(1)} <span class="text-xs text-slate-500 font-bold transition-none">Ù‡Ù…Øª</span>`;
            document.getElementById('kpi-avg').innerHTML = `${((totalCapacity/5)/1000).toFixed(1)} <span class="text-xs text-slate-500 font-bold transition-none">Ù‡Ù…Øª</span>`;
            document.getElementById('kpi-shareholder').innerHTML = `${(shareholder/1000).toFixed(1)} <span class="text-xs text-blue-400 font-bold transition-none">Ù‡Ù…Øª</span>`;
            document.getElementById('kpi-infra').innerHTML = `${(infraBudget/1000).toFixed(1)} <span class="text-xs text-emerald-400 font-bold transition-none">Ù‡Ù…Øª</span>`;
            
            document.getElementById('lbl-shareholder-perc').innerText = `${100 - state.infraShare}Ùª ØªØ®ØµÛŒØµ`;
            document.getElementById('lbl-infra-perc').innerText = `${state.infraShare}Ùª ØªØ®ØµÛŒØµ`;

            let tPerc = totalCapacity > 0 ? (totalTourism / totalCapacity) * 100 : 0;
            let hPerc = totalCapacity > 0 ? (grandTotalRE_Realized / totalCapacity) * 100 : 0;
            document.getElementById('bar-mix-tourism').style.width = `${tPerc}%`;
            document.getElementById('bar-mix-housing').style.width = `${hPerc}%`;
            document.getElementById('lbl-mix-tourism').innerText = `Ú¯Ø±Ø¯Ø´Ú¯Ø±ÛŒ ${Math.round(tPerc)}%`;
            document.getElementById('lbl-mix-housing').innerText = `Ù…Ø³Ú©ÙˆÙ†ÛŒ ${Math.round(hPerc)}%`;
            document.getElementById('donut-total').innerText = (totalCapacity/1000).toFixed(1);

            drawTourismChart(tourismSeries);
            drawHousingChart(reModFactor);
            drawMixChart(totalTourism, grandTotalRE_Realized);
        }

        Chart.defaults.font.family = 'Vazirmatn';

        function drawSparkline(canvasId, data, color) {
            const ctx = document.getElementById(canvasId).getContext('2d');
            
            let gradient = ctx.createLinearGradient(0, 0, 0, 60);
            gradient.addColorStop(0, color + '66'); 
            gradient.addColorStop(1, color + '00'); 
            
            let peakVal = Math.max(...data);
            let peakIndex = peakVal > 0 ? data.indexOf(peakVal) : -1;
            
            let pointRadii = data.map((v, i) => i === peakIndex ? 5 : 2);

            if(sparklineCharts[canvasId]) sparklineCharts[canvasId].destroy();
            
            sparklineCharts[canvasId] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['1405','1406','1407','1408','1409'],
                    datasets: [{
                        data: data, borderColor: color, backgroundColor: gradient,
                        borderWidth: 2, fill: true, tension: 0.4,
                        pointRadius: pointRadii, pointBackgroundColor: color,
                        pointBorderColor: '#fff', pointBorderWidth: 1.5, pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    layout: { padding: { top: 10, bottom: 5, left: 5, right: 5 } }, 
                    plugins: { legend: {display:false}, tooltip: {display:false} },
                    scales: { x: {display:false}, y: {display:false, min: 0} },
                    animation: { duration: 600 }
                }
            });
        }

        function drawTourismChart(data) {
            const ctx = document.getElementById('tourismChart').getContext('2d');
            let gradient = ctx.createLinearGradient(0, 0, 0, 300);
            gradient.addColorStop(0, 'rgba(14, 165, 233, 0.4)');
            gradient.addColorStop(1, 'rgba(14, 165, 233, 0.0)');

            if(tourismChart) tourismChart.destroy();
            tourismChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Ø³Ø§Ù„ Û±Û´Û°Ûµ','Ø³Ø§Ù„ Û±Û´Û°Û¶','Ø³Ø§Ù„ Û±Û´Û°Û·','Ø³Ø§Ù„ Û±Û´Û°Û¸','Ø³Ø§Ù„ Û±Û´Û°Û¹'],
                    datasets: [{
                        label: 'Ø¯Ø±Ø¢Ù…Ø¯ Ú¯Ø±Ø¯Ø´Ú¯Ø±ÛŒ (Ù…ÛŒÙ„ÛŒØ§Ø±Ø¯ ØªÙˆÙ…Ø§Ù†)', data: data, borderColor: '#0ea5e9', backgroundColor: gradient,
                        borderWidth: 3, fill: true, tension: 0.4, pointBackgroundColor: '#ffffff', pointBorderColor: '#0ea5e9', pointRadius: 4
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: {display:false}, tooltip: {titleFont:{family:'Vazirmatn'}, bodyFont:{family:'Vazirmatn'}} },
                    scales: { x: { grid: {display:false} }, y: { grid: {borderDash: [4,4], color: '#f1f5f9'}, beginAtZero: true } }
                }
            });
        }

        function drawHousingChart(modifier) {
            const ctx = document.getElementById('housingChart').getContext('2d');
            
            let datasets = projectsData.map(proj => {
                let projTotalVal = proj.baseTotal * modifier;
                let pData = state.allocations.map(pct => projTotalVal * (pct / 100));
                return {
                    label: proj.name,
                    data: pData,
                    backgroundColor: proj.color + 'E6',
                    borderColor: '#ffffff', 
                    borderWidth: 1.5,
                    fill: true,
                    tension: 0.4,
                    pointRadius: 0
                }
            });

            if(housingChart) housingChart.destroy();
            housingChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Ø³Ø§Ù„ Û±Û´Û°Ûµ','Ø³Ø§Ù„ Û±Û´Û°Û¶','Ø³Ø§Ù„ Û±Û´Û°Û·','Ø³Ø§Ù„ Û±Û´Û°Û¸','Ø³Ø§Ù„ Û±Û´Û°Û¹'],
                    datasets: datasets
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { 
                        legend: { position: 'bottom', labels: {boxWidth: 10, font:{family:'Vazirmatn', size:11, weight:'bold'}} },
                        tooltip: { mode: 'index', intersect: false, titleFont:{family:'Vazirmatn'}, bodyFont:{family:'Vazirmatn'} }
                    },
                    scales: { 
                        x: { grid: {display:false} }, 
                        /* V5 FIX: Set to 20,000 to prevent cutting off the 17.4T peaks! */
                        y: { stacked: true, suggestedMax: 20000, grid: {borderDash: [4,4], color: '#f1f5f9'}, beginAtZero: true } 
                    },
                    interaction: { mode: 'nearest', axis: 'x', intersect: false },
                    animation: { duration: 600 }
                }
            });
        }

        function drawMixChart(tourism, housing) {
            const ctx = document.getElementById('mixChart').getContext('2d');
            if(mixChart) mixChart.destroy();
            mixChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Ú¯Ø±Ø¯Ø´Ú¯Ø±ÛŒ', 'Ù…Ø³Ú©ÙˆÙ†ÛŒ/Ù…Ø´Ø§Ø±Ú©ØªÛŒ'],
                    datasets: [{
                        data: [tourism, housing],
                        backgroundColor: ['#0ea5e9', '#d946ef'],
                        borderWidth: 2, borderColor: '#fff', hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false, cutout: '75%',
                    plugins: { legend: { display: false }, tooltip: { bodyFont:{family:'Vazirmatn'} } }
                }
            });
        }

        function setupHousingSliders() {
            const container = document.getElementById('housing-sliders-container');
            container.innerHTML = '';
            const years = [1405, 1406, 1407, 1408, 1409];
            
            years.forEach((year, index) => {
                let col = document.createElement('div');
                col.innerHTML = `
                    <div class="flex justify-between items-center text-[10px] font-bold text-slate-300 mb-1">
                        <span>Ø³Ø§Ù„ ${year}</span>
                        <span id="val-alloc-${index}" class="text-purple-400 bg-slate-700 px-1 py-0.5 rounded">${state.allocations[index]}%</span>
                    </div>
                    <input type="range" class="slider-purple housing-slider" data-index="${index}" min="0" max="100" value="${state.allocations[index]}">
                `;
                container.appendChild(col);

                col.querySelector('input').addEventListener('input', function(e) {
                    let newVal = parseInt(e.target.value);
                    let otherSum = state.allocations.reduce((sum, val, i) => i === index ? sum : sum + val, 0);
                    if (otherSum + newVal > 100) newVal = 100 - otherSum; 
                    
                    e.target.value = newVal;
                    state.allocations[index] = newVal;
                    document.getElementById(`val-alloc-${index}`).innerText = newVal + '%';
                    updateAllocProgressBar(); 
                    updateDashboard();
                });
            });
            updateAllocProgressBar();
        }

        function updateAllocProgressBar() {
            let total = state.allocations.reduce((a,b)=>a+b, 0);
            document.getElementById('val-total-alloc').innerText = total + '%';
            document.getElementById('val-free-alloc').innerText = (100 - total) + '%';
            document.getElementById('bar-alloc').style.width = total + '%';
        }

        function resetAll() {
            document.getElementById('sl-tourism').value = 35;
            document.getElementById('sl-housing').value = 0;
            document.getElementById('sl-infra').value = 30;
            state.tourismGrowth = 35;
            state.rePriceMod = 0;
            state.infraShare = 30;
            state.allocations = [0, 10, 20, 20, 10]; 
            
            document.getElementById('val-tourism').innerText = '35%';
            document.getElementById('val-housing').innerText = '0% (Ù¾Ø§ÛŒÙ‡)';
            document.getElementById('val-infra').innerText = '30%';
            
            setupHousingSliders(); 
            updateDashboard();
        }

        document.getElementById('sl-tourism').addEventListener('input', (e) => {
            state.tourismGrowth = parseInt(e.target.value);
            document.getElementById('val-tourism').innerText = state.tourismGrowth + '%';
            updateDashboard();
        });

        document.getElementById('sl-housing').addEventListener('input', (e) => {
            state.rePriceMod = parseInt(e.target.value);
            let sign = state.rePriceMod > 0 ? '+' : '';
            document.getElementById('val-housing').innerText = `${sign}${state.rePriceMod}%`;
            updateDashboard();
        });

        document.getElementById('sl-infra').addEventListener('input', (e) => {
            state.infraShare = parseInt(e.target.value);
            document.getElementById('val-infra').innerText = state.infraShare + '%';
            updateDashboard();
        });

        setupHousingSliders();
        updateDashboard();

    </script>
</body>
</html>
